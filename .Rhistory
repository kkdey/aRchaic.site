plot_type = "left",
strand = "both")
aRchaic_mutation_trend(file, pattern = pattern,
plot_type = "right",
strand = "both")
file <- "../data/Jones_2015/Bichon.sort.rmdup.IR.q30.mapDamage.subsampled.q30.csv"
data <- read.csv(file, header=FALSE)
data[1:5,]
grep("C->T", data[,1])
indices <- grep("C->T", data[,1])
data_filt <- data[indices, ]
data_filt[1:20,]
data_filt[1:100,]
data_filt[100:200,]
data_filt[500:600,]
i <- 1
pattern
pattern_data <- data[grep(pattern[i], data[,1]),]
pattern_data[,7] <- pattern_data[,7]/totsum;
if(length(which(pattern_data[,3]==-1)) !=0){
pattern_data[which(pattern_data[,3]==-1), 3] <- 0
}
if(min(pattern_data[,3]) == 1){ pattern_data[,3] = pattern_data[,3] - 1}
pattern_data <- pattern_data[pattern_data[,2] < numBases | pattern_data[,3] < numBases, ]
pattern_data[1:5,]
tab_pattern_left <- tapply(pattern_data[pattern_data[,2] < numBases,7], pattern_data[pattern_data[,2] < numBases,2], sum);
tab_pattern_left
lo_left <- loess(as.numeric(tab_pattern_left)~as.numeric(names(tab_pattern_left)))
lo_left
as.numeric(names(tab_pattern_left))
temp <- predict(lo_left)
temp
as.numeric(names(tab_pattern_left))
values <- as.numeric(names(tab_pattern_left))
values
temp2 <- predict(lo_left)
values <- as.numeric(names(tab_pattern_left))
temp <- array(0, numBases)
temp[match(values, 1:numBases)] <- temp2
temp
source('~/Documents/aRchaic.site/R/aRchaic_mutation_trend.R')
par(mfrow=c(1,2))
aRchaic_mutation_trend(file, pattern = pattern,
plot_type = "left",
strand = "both")
aRchaic_mutation_trend(file, pattern = pattern,
plot_type = "right",
strand = "both")
temp2 <- predict(lo_left)
values <- as.numeric(names(tab_pattern_left))
temp <- array(0, numBases)
temp[match(values, 1:numBases)] <- temp2
temp[temp < 0] =0
if(max(temp) < 1e-03){ temp <- temp*(1e-03/max(temp))}
plot(temp, col=cols[i], ylim= c(0,max(temp)+0.0005),
xlim = c(1, numBases), lwd=2, type="l",
ylab=paste0("predicted no. of damages: "),
xlab="read positions (from left)",
xaxs="i",yaxs="i",
main=paste0("Damage plot (5' end) : "),
cex.main = main_cex
)
pattern
i <- 3
flag <- c(flag, i);
pattern_data <- data[grep(pattern[i], data[,1]),]
pattern_data[,7] <- pattern_data[,7]/totsum;
if(length(which(pattern_data[,3]==-1)) !=0){
pattern_data[which(pattern_data[,3]==-1), 3] <- 0
}
if(min(pattern_data[,3]) == 1){ pattern_data[,3] = pattern_data[,3] - 1}
pattern_data <- pattern_data[pattern_data[,2] <= numBases | pattern_data[,3] <= numBases, ]
tab_pattern_left <- tapply(pattern_data[pattern_data[,2] <= numBases,7], pattern_data[pattern_data[,2] <= numBases,2], sum);
lo_left <- loess(as.numeric(tab_pattern_left)~as.numeric(names(tab_pattern_left)))
tab_pattern_right <- tapply(pattern_data[pattern_data[,3] <= numBases,7], pattern_data[pattern_data[,3] <= numBases,3], sum);
lo_right <- loess(as.numeric(tab_pattern_right)~as.numeric(names(tab_pattern_right)))
lo_left
as.numeric(names(tab_pattern_right))
temp2 <- predict(lo_left)
values <- as.numeric(names(tab_pattern_left))
temp <- array(0, numBases)
temp[match(values, 1:numBases)] <- temp2
temp[temp < 0] =0
if(max(temp) < 1e-03){ temp <- temp*(1e-03/max(temp))}
plot(temp, col=cols[i], ylim= c(0,max(temp)+0.0005),
xlim = c(1, numBases), lwd=2, type="l",
ylab=paste0("predicted no. of damages: "),
xlab="read positions (from left)",
xaxs="i",yaxs="i",
main=paste0("Damage plot (5' end) : "),
cex.main = main_cex
)
values
temp2 <- predict(lo_left)
values <- as.numeric(names(tab_pattern_left))
temp <- array(0, numBases)
temp[match(values, 0:numBases)] <- temp2
temp[temp < 0] =0
if(max(temp) < 1e-03){ temp <- temp*(1e-03/max(temp))}
plot(temp, col=cols[i], ylim= c(0,max(temp)+0.0005),
xlim = c(1, numBases), lwd=2, type="l",
ylab=paste0("predicted no. of damages: "),
xlab="read positions (from left)",
xaxs="i",yaxs="i",
main=paste0("Damage plot (5' end) : "),
cex.main = main_cex
)
source('~/Documents/aRchaic.site/R/aRchaic_mutation_trend.R')
par(mfrow=c(1,2))
aRchaic_mutation_trend(file, pattern = pattern,
plot_type = "left",
strand = "both")
aRchaic_mutation_trend(file, pattern = pattern,
plot_type = "right",
strand = "both")
source('~/Documents/aRchaic.site/R/aRchaic_mutation_trend.R')
par(mfrow=c(1,2))
aRchaic_mutation_trend(file, pattern = pattern,
plot_type = "left",
strand = "both")
aRchaic_mutation_trend(file, pattern = pattern,
plot_type = "right",
strand = "both")
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
plot_type = "left",
strand = "both")
aRchaic_mutation_trend(file,
plot_type = "right",
strand = "both")
source('~/Documents/aRchaic.site/R/aRchaic_mutation_trend.R')
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
plot_type = "left",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 3)
aRchaic_mutation_trend(file,
plot_type = "right",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 3)
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
plot_type = "left",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3)
aRchaic_mutation_trend(file,
plot_type = "right",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3)
file <- "../data/Pinhasi/KO1.q30.csv"
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
plot_type = "left",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3)
aRchaic_mutation_trend(file,
plot_type = "right",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3)
source('~/Documents/aRchaic.site/R/aRchaic_mutation_trend.R')
source('~/Documents/aRchaic.site/R/aRchaic_mutation_trend.R')
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
plot_type = "left",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.5)
aRchaic_mutation_trend(file,
plot_type = "right",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.5)
file <- "../data/Pinhasi/KO1.q30.csv"
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
plot_type = "left",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.7)
aRchaic_mutation_trend(file,
plot_type = "right",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.7)
file <- "../data/AnnaGosling2016data/ADR-T1-CNE1.dup.q30.csv"
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
pattern = c("C->T", "T->C", "C->A"),
plot_type = "left",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.7)
aRchaic_mutation_trend(file,
pattern = c("C->T", "T->C", "C->A"),
plot_type = "right",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.7)
file <- "../data/AnnaGosling2016data/ADR-T1-CNE1.dup.q30.csv"
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
pattern = c("C->T", "G->A", "T->C", "C->A"),
plot_type = "left",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.7)
aRchaic_mutation_trend(file,
pattern = c("C->T", "G->A", "T->C", "C->A"),
plot_type = "right",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.7)
file <- "../data/AnnaGosling2016data/ADR-T1-KS20.dup.q30.csv"
par(mfrow=c(1,2))
aRchaic_mutation_trend(file,
plot_type = "left",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.7)
aRchaic_mutation_trend(file,
plot_type = "right",
strand = "both",
layout_left = "topright",
layout_right = "topleft",
legend_cex = 0.3,
lab_cex = 0.7)
mat1 <- get(load("../data/Fu_2016/Fu_2016.rda"))
mat2 <- get(load("../data/moderns_lite/moderns_lite.rda"))
dim(mat1)
dim(mat2)
mat_pooled <- rbind(mat1, mat2)
dim(mat_pooled)
mat_reduced <- filter_by_mutation(mat_pooled)
dim(mat_reduced)
signature_set <- colnames(mat_reduced)
signature_set
signature_set <- colnames(mat_reduced)
new_sig_split <- matrix(0, length(signature_set), 1);
levels(new_sig_split[,1]) <- c("0", "1", "2", "3", "4", "5")
new_sig_split
signature_set <- colnames(mat_reduced)
new_sig_split <- matrix(0, length(signature_set), 1);
new_sig_split
signature_set <- colnames(mat_reduced)
new_sig_split <- matrix(0, length(signature_set), 1);
new_sig_split[,1] <- signature_set
new_sig_split
levels(new_sig_split[,1]) <- c("0", "1", "2", "3", "4", "5")
new_sig_split
suppressWarnings(topic_clus <- do.call(maptpx::topics, append(list(counts = pooled_data, K=K, tol=tol, model = "independent", signatures = new_sig_split), topics.control)))
suppressWarnings(topic_clus <- do.call(maptpx::topics, append(list(counts = mat_reduced, K=K, tol=tol, model = "independent", signatures = new_sig_split), topics.control)))
K=3
tol = 0.01
suppressWarnings(topic_clus <- do.call(maptpx::topics, append(list(counts = mat_reduced, K=K, tol=tol, model = "independent", signatures = new_sig_split), topics.control)))
topics.control <- list()
topics.control.default <- list(bf = FALSE, kill = 2, ord = TRUE, verb = 1, admix = TRUE,
nbundles = 1, use_squarem = FALSE, init.adapt = FALSE, type = "full",
light = 1, method_admix = 1, sample_init = TRUE, tmax = 10000)
topics.control <- modifyList(topics.control.default, topics.control)
suppressWarnings(topic_clus <- do.call(maptpx::topics, append(list(counts = mat_reduced, K=K, tol=tol, model = "independent", signatures = new_sig_split), topics.control)))
new_sig_split
suppressWarnings(topic_clus <- do.call(maptpx::topics, append(list(counts = mat_reduced, K=K, tol=tol, model = "independent", signatures = signature_set), topics.control)))
suppressWarnings(topic_clus <- do.call(maptpx::topics, append(list(counts = mat_reduced, K=K, tol=tol, model = "full", signatures = NULL), topics.control)))
omega <- topic_clus$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(labs, levels = levels)
)
if(is.null(output_dir)){ output_dir <- paste0(getwd(),"/")}
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
labs <- c(rep("fu", 44), rep("moderns", 50))
omega <- topic_clus$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(labs, levels = levels)
)
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
plot.new()
grid::grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
print(do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control)))
omega
?StructureGGplot
??StructureGGplot
do.call(CountClust::StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
dev.off()
do.call(CountClust::StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
StructureGGplot
do.call(CountClust::StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
plot(1,2)
do.call(CountClust::StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
source('~/Documents/ancient-damage/R/../../CountClust/R/StructureGGplot.R')
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
StructureGGplot(omega = omega,
annotation = annotation,
palette = topic_cols)
CountClust::StructureGGplot(omega = omega,
annotation = annotation,
palette = topic_cols)
CountClust::StructureGGplot(omega = omega,
annotation = annotation,
palette = topic_cols)
plot.new()
par(mar=c(1,1,1,1))
CountClust::StructureGGplot(omega = omega,
annotation = annotation,
palette = topic_cols)
output_dir <- NULL
if(is.null(output_dir)){ output_dir <- paste0(getwd(),"/")}
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure.png"), width = structure_width,
height = structure_height)
getw()
getwd()
structure_width = 5
structure_height = 8
plot.new()
grid::grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure-mutation.png"), width = structure_width,
height = structure_height)
structure.control.default <- list(yaxis_label = "aRchaic pops",
order_sample = FALSE,
figure_title = paste0("  StructurePlot: K=", K,""),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 10,
axis_label_face = "bold"),
legend_title_size = 10,
legend_key_size = 0.7,
legend_text_size = 8)
structure.control <- list()
structure.control <- modifyList(structure.control.default, structure.control)
output_dir <- NULL
if(is.null(output_dir)){ output_dir <- paste0(getwd(),"/")}
structure_width = 5
structure_height = 8
plot.new()
grid::grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure-mutation.png"), width = structure_width,
height = structure_height)
output_dir
source('~/Documents/ancient-damage/R/../../CountClust/R/StructureGGplot.R')
structure.control <- list()
structure.control <- modifyList(structure.control.default, structure.control)
output_dir <- NULL
if(is.null(output_dir)){ output_dir <- paste0(getwd(),"/")}
structure_width = 5
structure_height = 8
plot.new()
grid::grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure-mutation.png"), width = structure_width,
height = structure_height)
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
library(ggplot2)
library(grid)
structure_width = 5
structure_height = 8
plot.new()
grid::grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure-mutation.png"), width = structure_width,
height = structure_height)
output_dir <- "../utilities/structure-mutation/"
if(is.null(output_dir)){ output_dir <- paste0(getwd(),"/")}
structure_width = 5
structure_height = 8
plot.new()
grid::grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure-mutation.png"), width = structure_width,
height = structure_height)
omega
omega
as.matrix(omega)
labs <- c(rep("fu", 44), rep("moderns", 50))
omega <- topic_clus$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(labs, levels = levels)
)
rownames(omega) <- annotation$sample_id
structure.control.default <- list(yaxis_label = "aRchaic pops",
order_sample = FALSE,
figure_title = paste0("  StructurePlot: K=", K,""),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 10,
axis_label_face = "bold"),
legend_title_size = 10,
legend_key_size = 0.7,
legend_text_size = 8)
structure.control <- list()
structure.control <- modifyList(structure.control.default, structure.control)
output_dir <- "../utilities/structure-mutation/"
if(is.null(output_dir)){ output_dir <- paste0(getwd(),"/")}
structure_width = 5
structure_height = 8
plot.new()
grid::grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure-mutation.png"), width = structure_width,
height = structure_height)
structure_width = 5
structure_height = 8
plot.new()
grid::grid.newpage()
do.call(StructureGGplot, c(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure-mutation.png"), width = structure_width,
height = structure_height)
do.call(CountClust::StructureGGplot, c(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))

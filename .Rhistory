labs <- c(rep("moderns", 50), rep("Fu", length(files)))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 4,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/moderns_Fu/clus_4/",
save_plot = TRUE)
folders <- c("../data/moderns_lite/", "../data/Fu_2016/")
files <- list.files(folders[2], pattern = ".csv")
labs <- c(rep("moderns", 50), rep("Fu", length(files)))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 3,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/moderns_Fu/clus_3/",
save_plot = TRUE)
folders <- c("../data/moderns_lite/", "../data/Fu_2016/")
files <- list.files(folders[2], pattern = ".csv")
labs <- c(rep("moderns", 50), rep("Fu", length(files)))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 2,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/moderns_Fu/clus_2/",
save_plot = TRUE)
setwd("~/Documents/ancient-damage/R")
folders <- c("../data/moderns_lite/", "../data/Raghavan/")
files <- list.files(folders[2], pattern = ".csv")
files
labs_raghavan <- substring(files, 1, 2)
labs_raghavan
folders <- c("../data/moderns_lite/", "../data/Raghavan/")
files <- list.files(folders[2], pattern = ".csv")
labs_raghavan <- substring(files, 1, 2)
labs <- c(rep("moderns", 50), labs_raghavan)
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 2,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/moderns_Raghavan/clus_2/",
save_plot = TRUE)
source('~/Documents/CountClust/R/StructureGGplot.R')
source("../../aRchaic.site/R/aggregate_signature_counts.R")
source("../../aRchaic.site/R/club_signature_counts.R")
source("../../aRchaic.site/R/aRchaic_view.R")
source("../../aRchaic.site/R/filter_signatures_only_location.R")
source("../../aRchaic.site/R/aRchaic_cluster.R")
source("../../aRchaic.site/R/aRchaic_pool.R")
source("../../aRchaic.site/R/damageLogo_5.R")
source("../../CountClust/R/StructureGGplot.R")
folders <- c("../data/moderns_lite/", "../data/Raghavan/")
files <- list.files(folders[2], pattern = ".csv")
labs_raghavan <- substring(files, 1, 2)
labs <- c(rep("moderns", 50), labs_raghavan)
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 2,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/moderns_Raghavan/clus_2/",
save_plot = TRUE)
clus_out <- aRchaic_cluster(folders = folders,
K = 2,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/moderns_Raghavan/clus_2/",
save_plot = TRUE)
files <- list.files(folders[2], pattern = ".csv")
files
source("../../CountClust/R/StructureGGplot.R")
clus_out <- aRchaic_cluster(folders = folders,
K = 2,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/moderns_Raghavan/clus_2/",
save_plot = TRUE)
folders <- c("../data/moderns_lite/", "../data/Raghavan/")
files <- list.files(folders[2], pattern = ".csv")
labs_raghavan <- substring(files, 1, 2)
labs <- c(rep("moderns", 50), labs_raghavan)
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 3,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/moderns_Raghavan/clus_3/",
save_plot = TRUE)
files
list.files("../data/Fu_2016/")
list.files("../data/Fu_2016/", pattern = ".csv")
folders <- c("../data/Lindo2016/")
labs <- c(rep("ancient", 25),
rep("moderns", 25))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 3,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016/clus_3/",
save_plot = TRUE)
folders <- c("../data/Lindo2016/")
labs <- c(rep("ancient", 25),
rep("moderns", 25))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 2,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016/clus_2/",
save_plot = TRUE)
folders <- c("../data/Lindo2016/")
labs <- c(rep("ancient", 25),
rep("moderns", 25))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 4,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016/clus_4/",
save_plot = TRUE)
model <- get(load("../utilities/Lindo2016/clus_3/model.rda"))
dim(model)
model <- get(load("../data/Lindo2016/Lindo2016.rda"))
model
dim(model)
list.files(folders)
rownames(model)
dat <- get(load("../data/Lindo2016/Lindo2016.rda"))
folders <- c("../data/Lindo2016/")
labs <- c(rep("ancient", 25),
rep("moderns", 25))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 4,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016/clus_4/",
save_plot = TRUE)
dat <- get(load("../data/Lindo2016/Lindo2016.rda"))
dat <- dat[-25, ]
signature_set <- colnames(dat)
sig_split <- t(sapply(1:length(signature_set), function(x) return(strsplit(signature_set[x], "")[[1]][1:8])))
new_sig_split <- matrix(0, dim(sig_split)[1], 3);
new_sig_split[,1] <- sig_split[,1]
new_sig_split[,2] <- sapply(1:length(signature_set), function(x) return(paste(sig_split[x,2:5], collapse="")))
new_sig_split[,3] <- sig_split[,6]
levels(new_sig_split[,1]) <- c("0", "1", "2", "3", "4")
pos <- t(sapply(1:length(signature_set), function(x)
{
y = strsplit(signature_set[x], "")[[1]]
return(paste(y[12:length(y)], collapse=""))
}))
mat <- matrix(0, dim(new_sig_split)[1], dim(new_sig_split)[2])
for(k in 1:dim(new_sig_split)[2]){
temp <- as.factor(new_sig_split[,k])
mat[,k] <- as.numeric(as.matrix(plyr::mapvalues(temp, from = levels(temp), to = 0:(length(levels(temp))-1))))
}
pos <- as.numeric(pos)
pos <- pos - min(pos)
pos <- factor(pos, levels = 0:21)
signatures <- mat;
signature_pos <- cbind.data.frame(signatures, pos)
topic_clus <- maptpx::topics(dat, K=4, type="independent", tol=50,
signatures = signature_pos)
omega <- topic_clus$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(labs, levels = levels)
)
rownames(omega) <- annotation$sample_id
output_dir <- "../utilities/Lindo2016_wo_939/clus_4/"
topic_cols = c("red","blue","darkgoldenrod1","cyan","firebrick", "green",
"hotpink","burlywood","yellow","darkgray","deepskyblue","darkkhaki",
"brown4","darkorchid","magenta","yellow", "azure1","azure4")
structure_width = 5
structure_height = 8
structure.control <- list()
structure.control.default <- list(yaxis_label = "aRchaic pops",
order_sample = FALSE,
figure_title = paste0("  StructurePlot: K=", K,""),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 10,
axis_label_face = "bold"),
legend_title_size = 10,
legend_key_size = 0.7,
legend_text_size = 8)
structure.control <- modifyList(structure.control, structure.control.default)
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure.png"), width = structure_width,
height = structure_height)
plot.new()
damageLogo_five(topic_clus$theta, save_plot=TRUE, output_dir = output_dir)
graphics.off()
labs <- labs[-25]
levels <- unique(labs)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(labs, levels = levels)
)
rownames(omega) <- annotation$sample_id
output_dir <- "../utilities/Lindo2016_wo_939/clus_4/"
topic_cols = c("red","blue","darkgoldenrod1","cyan","firebrick", "green",
"hotpink","burlywood","yellow","darkgray","deepskyblue","darkkhaki",
"brown4","darkorchid","magenta","yellow", "azure1","azure4")
structure_width = 5
structure_height = 8
structure.control <- list()
structure.control.default <- list(yaxis_label = "aRchaic pops",
order_sample = FALSE,
figure_title = paste0("  StructurePlot: K=", K,""),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 10,
axis_label_face = "bold"),
legend_title_size = 10,
legend_key_size = 0.7,
legend_text_size = 8)
structure.control <- modifyList(structure.control, structure.control.default)
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure.png"), width = structure_width,
height = structure_height)
plot.new()
damageLogo_five(topic_clus$theta, save_plot=TRUE, output_dir = output_dir)
graphics.off()
K=4
structure.control.default <- list(yaxis_label = "aRchaic pops",
order_sample = FALSE,
figure_title = paste0("  StructurePlot: K=", K,""),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 10,
axis_label_face = "bold"),
legend_title_size = 10,
legend_key_size = 0.7,
legend_text_size = 8)
structure.control <- modifyList(structure.control, structure.control.default)
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure.png"), width = structure_width,
height = structure_height)
plot.new()
damageLogo_five(topic_clus$theta, save_plot=TRUE, output_dir = output_dir)
graphics.off()
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure.png"), width = structure_width,
height = structure_height)
plot.new()
damageLogo_five(topic_clus$theta, save_plot=TRUE,
inflation_factor = c(2,1,2), output_dir = output_dir)
graphics.off()
topic_clus <- maptpx::topics(dat, K=3, type="independent", tol=50,
signatures = signature_pos)
omega <- topic_clus$omega
#
levels <- unique(labs)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(labs, levels = levels)
)
rownames(omega) <- annotation$sample_id
output_dir <- "../utilities/Lindo2016_wo_939/clus_3/"
topic_cols = c("red","blue","darkgoldenrod1","cyan","firebrick", "green",
"hotpink","burlywood","yellow","darkgray","deepskyblue","darkkhaki",
"brown4","darkorchid","magenta","yellow", "azure1","azure4")
structure_width = 5
structure_height = 8
structure.control <- list()
K=3
structure.control.default <- list(yaxis_label = "aRchaic pops",
order_sample = FALSE,
figure_title = paste0("  StructurePlot: K=", K,""),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 10,
axis_label_face = "bold"),
legend_title_size = 10,
legend_key_size = 0.7,
legend_text_size = 8)
structure.control <- modifyList(structure.control, structure.control.default)
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure.png"), width = structure_width,
height = structure_height)
plot.new()
damageLogo_five(topic_clus$theta, save_plot=TRUE,
inflation_factor = c(2,1,2), output_dir = output_dir)
graphics.off()
topic_clus <- maptpx::topics(dat, K=2, type="independent", tol=50,
signatures = signature_pos)
omega <- topic_clus$omega
#
levels <- unique(labs)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(labs, levels = levels)
)
rownames(omega) <- annotation$sample_id
output_dir <- "../utilities/Lindo2016_wo_939/clus_2/"
topic_cols = c("red","blue","darkgoldenrod1","cyan","firebrick", "green",
"hotpink","burlywood","yellow","darkgray","deepskyblue","darkkhaki",
"brown4","darkorchid","magenta","yellow", "azure1","azure4")
structure_width = 5
structure_height = 8
structure.control <- list()
K=2
structure.control.default <- list(yaxis_label = "aRchaic pops",
order_sample = FALSE,
figure_title = paste0("  StructurePlot: K=", K,""),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 10,
axis_label_face = "bold"),
legend_title_size = 10,
legend_key_size = 0.7,
legend_text_size = 8)
structure.control <- modifyList(structure.control, structure.control.default)
plot.new()
grid.newpage()
do.call(StructureGGplot, append(list(omega= omega,
annotation = annotation,
palette = topic_cols),
structure.control))
ggplot2::ggsave(paste0(output_dir, "structure.png"), width = structure_width,
height = structure_height)
plot.new()
damageLogo_five(topic_clus$theta, save_plot=TRUE,
inflation_factor = c(2,1,2), output_dir = output_dir)
graphics.off()
folders <- c("../data/Lindo2016moderns/")
labs <- c(rep("moderns", 25))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 4,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016moderns/clus_4/",
save_plot = TRUE)
folders <- c("../data/Lindo2016moderns/")
labs <- c(rep("moderns", 25))
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 4,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016moderns/clus_4/",
save_plot = TRUE)
folders <- c("../data/Lindo2016moderns/")
list.files(folders, pattern = ".csv")
lind_metadata <- read.table("../utilities/Lindo_metadata.txt")
lindo_metadata <- read.table("../utilities/Lindo_metadata.txt")
lindo_metadata
list.files(folders)
labs <- lindo_metadata[,2]
levels <- unique(labs)
length(labs)
lindo_metadata <- read.table("../utilities/Lindo_metadata.txt")
folders <- c("../data/Lindo2016moderns/")
labs <- lindo_metadata[,2]
levels <- unique(labs)
clus_out <- aRchaic_cluster(folders = folders,
K = 4,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016moderns/clus_4/",
save_plot = TRUE)
clus_out <- aRchaic_cluster(folders = folders,
K = 3,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016moderns/clus_3/",
save_plot = TRUE)
clus_out <- aRchaic_cluster(folders = folders,
K = 2,
labs = labs,
levels = levels,
tol = 10,
run_from = "plot",
output_dir = "../utilities/Lindo2016moderns/clus_2/",
save_plot = TRUE)
aRchaic_view (dir = "../data/Skoglund/Ajv59.hs37d5.fa.merged.q30.csv",
breaks = c(-1, seq(1,20, 2)),
flanking_bases =1,
logo.control = list(),
title = "Skoglund aDNA",
output_dir = NULL,
save_plot = TRUE)
aRchaic_view (dir = "../data/Skoglund/Ajv59.hs37d5.fa.merged.q30.csv",
breaks = c(-1, seq(1,20, 2)),
flanking_bases =1,
logo.control = list(),
title = "Skoglund aDNA",
output_dir = NULL,
save_plot = FALSE)
aRchaic_view (file = "../data/Skoglund/Ajv59.hs37d5.fa.merged.q30.csv",
breaks = c(-1, seq(1,20, 2)),
flanking_bases =1,
logo.control = list(),
title = "Skoglund aDNA",
output_dir = NULL,
save_plot = FALSE)
grid.newpage()
aRchaic_view (file = "../data/Skoglund/Ajv59.hs37d5.fa.merged.q30.csv",
breaks = c(-1, seq(1,20, 2)),
flanking_bases =1,
logo.control = list(),
title = "Skoglund aDNA",
output_dir = NULL,
save_plot = FALSE)
grid.newpage()
par(new=TRUE)
aRchaic_view (file = "../data/Skoglund/Ajv59.hs37d5.fa.merged.q30.csv",
breaks = c(-1, seq(1,20, 2)),
flanking_bases =1,
logo.control = list(),
title = "Skoglund aDNA",
output_dir = NULL,
save_plot = FALSE)
grid.newpage()
par(new=TRUE)
aRchaic_view (file = "../data/Skoglund/Ajv59.hs37d5.fa.merged.q30.csv",
breaks = c(-1, seq(1,20, 2)),
flanking_bases =1,
logo.control = list(),
title = "Skoglund aDNA",
output_dir = NULL,
save_plot = FALSE)
grid.newpage()
par(new=TRUE)
par(mar=c(1,1,1,1))
aRchaic_view (file = "../data/Skoglund/Ajv59.hs37d5.fa.merged.q30.csv",
breaks = c(-1, seq(1,20, 2)),
flanking_bases =1,
logo.control = list(),
title = "Skoglund aDNA",
output_dir = NULL,
save_plot = FALSE)
source('~/Documents/ancient-damage/R/../../aRchaic.site/R/damageLogo_5.R')
grid.newpage()
par(new=TRUE)
par(mar=c(1,1,1,1))
aRchaic_view (file = "../data/Skoglund/Ajv59.hs37d5.fa.merged.q30.csv",
breaks = c(-1, seq(1,20, 2)),
flanking_bases =1,
logo.control = list(),
title = "Skoglund aDNA",
output_dir = NULL,
save_plot = FALSE)
